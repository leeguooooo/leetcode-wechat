# Zhihu Lint

[![auto-publish](https://img.shields.io/badge/auto--publish-enabled-brightgreen.svg)](https://git.in.zhihu.com/fe/auto-publish)
[![coverage](http://build.in.zhihu.com/api/v1/repos/cfe/zhihu-lint/coverage/status.svg)](http://jenkins.in.zhihu.com/job/cfe-zhihu-lint-flow-std/cobertura)

Zhihu Lint is a no-configuration linter using [Prettier](https://prettier.io) and [ESLint](https://eslint.org).

## 特性

- 无配置使用，但可以根据需要进行配置和扩展
- 简单易用，无需指定文件，自动排除 `.gitignore` 外的所有文件，支持 lint-staged
- 友好的编辑器支持，无需安装定制的插件
- 集成主流的最佳实践：
  - [Prettier](https://prettier.io/)，自动格式化 .js、.jsx、.ts、.tsx、.json、.css、.md、.mdx、.yml(.yaml)
  - 集成 [eslint:recommended](https://eslint.org/docs/rules/)
  - 集成 [plugin:react/recommended](https://github.com/yannickcr/eslint-plugin-react)
  - 集成 [plugin:import/recommended](https://github.com/benmosher/eslint-plugin-import)
- 支持 TypeScript
  - 集成 [plugin:@typescript-eslint/recommended](https://github.com/typescript-eslint/typescript-eslint/blob/master/packages/eslint-plugin/README.md#supported-rules)
  - 集成 [plugin:@typescript-eslint/recommended-requiring-type-checking](https://github.com/typescript-eslint/typescript-eslint/blob/master/packages/eslint-plugin/README.md#supported-rules)
- 支持只检查变更文件（Git 变更，适用于开发时运行）
- 自动识别项目中的路径别名（通过 [tsconfig/jsconfig](https://www.typescriptlang.org/tsconfig#paths) 的 `paths` 定义）

## 安装

```bash
yarn add zhihu-lint prettier --dev
# or
# npm install zhihu-lint prettier --save-dev
```

## 使用

```
➜ npx zhihu-lint -h

  Usage: zhihu-lint [options]

  Options:

    -V, --version  output the version number
    -F, --fix      automatically fix problems
    --changed      run only on changed files
    -h, --help     output usage information
```

Add config to `package.json`:

```json
{
  "scripts": {
    "lint": "zhihu-lint",
    "lint:fix": "zhihu-lint --fix"
  }
}
```

Run:

```
npm run lint
```

### Git commit hook

Install lint-staged and husky:

```bash
yarn add lint-staged husky --dev
```

Add hook config to `package.json`:

```json
{
  "husky": {
    "hooks": {
      "pre-commit": "lint-staged"
    }
  },
  "lint-staged": {
    "*.{js,jsx,ts,tsx,json,css,md,mdx,yml,yaml}": [
      "zhihu-lint --fix",
      "git add"
    ]
  }
}
```

### 编辑器集成

添加 `.prettierrc.js`：

```bash
echo "module.exports = require('zhihu-lint/.prettierrc')" > .prettierrc.js
```

添加 `.eslintrc.js`：

```bash
echo "module.exports = require('zhihu-lint/.eslintrc')" > .eslintrc.js
```

### VS Code

安装 [Prettier Plugin](https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode) 和 [ESLint Plugin](https://marketplace.visualstudio.com/items?itemName=dbaeumer.vscode-eslint)，添加「用户配置」（<kbd>cmd</kbd> + <kbd>,</kbd>）：

```json
{
  "editor.formatOnSave": true,
  "prettier.requireConfig": true,
  "files.insertFinalNewline": true,
  "files.trimTrailingWhitespace": true,
  ...
}
```

如果你在使用 monorepo 或者项目依赖中有多个版本的 eslint，你需要告诉 `vscode-eslint` 如何正确引用，在项目下配置 `.vscode/settings.json`：

```json
{
  // 告诉 vscode-eslint 如何查找 eslint 本身（项目依赖中有多个版本的 eslint）
  "eslint.nodePath": "./node_modules/zhihu-lint",
  "eslint.options": {
    // 告诉 vscode-eslint 从哪个路径查找插件（monorepo）
    "resolvePluginsRelativeTo": "./node_modules/zhihu-lint"
  }
}
```

### 其他编辑器插件:

- [Prettier editor integration](https://github.com/prettier/prettier#editor-integration)
- [ESLint editor integration](https://eslint.org/docs/user-guide/integrations#editors)

### 扩展配置

你需要继承使用 zhihu-lint 的配置，再进行自定义：

```js
module.exports = {
  extends: [require.resolve('zhihu-lint/.eslintrc.js')],
  rules: {},
  settings: {},
}
```

## 相关

- [zhihu-lint-loader](https://git.in.zhihu.com/fe/zhihu-lint-loader): webpack loader（更建议使用编辑器集成）
